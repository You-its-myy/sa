<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Online Chat</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; }
  #chat { width:400px; background:white; border-radius:10px; overflow:hidden; display:flex; flex-direction:column; }
  #messages { flex:1; overflow-y:auto; padding:10px; border-bottom:1px solid #ddd; }
  .message { margin-bottom:10px; display:flex; align-items:flex-start; }
  .message img { width:30px; height:30px; border-radius:50%; margin-right:10px; }
  #inputArea { display:flex; flex-direction:column; padding:10px; gap:5px; }
  #inputArea input[type=text], #inputArea input[type=file] { width:100%; }
  #inputArea button { padding:8px; cursor:pointer; border:none; background:#007bff; color:white; border-radius:5px; }
</style>
</head>
<body>

<div id="chat">
  <div id="messages"></div>

  <div id="inputArea">
    <input type="text" id="username" placeholder="Adınızı girin">
    <input type="file" id="profilePic" accept="image/*">
    <input type="text" id="message" placeholder="Mesaj yazın">
    <input type="file" id="photo" accept="image/*">
    <input type="file" id="audio" accept="audio/*">
    <button onclick="sendMessage()">Gönder</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA49KR-d9hN6QXXcvZ68CfYLpMulad8p50",
  authDomain: "multiplayer-chat-552f7.firebaseapp.com",
  databaseURL: "https://multiplayer-chat-552f7-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "multiplayer-chat-552f7",
  storageBucket: "multiplayer-chat-552f7.firebasestorage.app",
  messagingSenderId: "658594907764",
  appId: "1:658594907764:web:18ca661bd9dd9f504df321",
  measurementId: "G-9JMN9DMG82"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

// Mesaj gönder
async function sendMessage() {
  const username = document.getElementById('username').value || "Anonim";
  const messageText = document.getElementById('message').value;
  const profileFile = document.getElementById('profilePic').files[0];
  const photoFile = document.getElementById('photo').files[0];
  const audioFile = document.getElementById('audio').files[0];

  let profileUrl = "";
  if(profileFile) {
    profileUrl = await uploadFile(profileFile, 'profiles');
  }

  let photoUrl = "";
  if(photoFile) {
    photoUrl = await uploadFile(photoFile, 'photos');
  }

  let audioUrl = "";
  if(audioFile) {
    audioUrl = await uploadFile(audioFile, 'audios');
  }

  db.ref('messages').push({
    username: username,
    profileUrl: profileUrl,
    message: messageText,
    photoUrl: photoUrl,
    audioUrl: audioUrl,
    timestamp: Date.now()
  });

  document.getElementById('message').value = "";
  document.getElementById('photo').value = "";
  document.getElementById('audio').value = "";
}

// Dosya yükleme
function uploadFile(file, folder) {
  return new Promise((resolve, reject) => {
    const storageRef = storage.ref(`${folder}/${Date.now()}_${file.name}`);
    storageRef.put(file).then(snapshot => {
      snapshot.ref.getDownloadURL().then(url => resolve(url));
    }).catch(reject);
  });
}

// Mesajları dinle
db.ref('messages').on('child_added', function(snapshot) {
  const msg = snapshot.val();
  const div = document.createElement('div');
  div.classList.add('message');

  const img = document.createElement('img');
  img.src = msg.profileUrl || 'https://via.placeholder.com/30';
  div.appendChild(img);

  const content = document.createElement('div');

  if(msg.message) content.innerHTML += `<div>${msg.username}: ${msg.message}</div>`;
  if(msg.photoUrl) content.innerHTML += `<div><img src="${msg.photoUrl}" style="max-width:200px;"></div>`;
  if(msg.audioUrl) content.innerHTML += `<div><audio controls src="${msg.audioUrl}"></audio></div>`;

  div.appendChild(content);
  document.getElementById('messages').appendChild(div);
  document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
});
</script>

</body>
</html>
